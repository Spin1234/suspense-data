<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Suspense Bangla | Audio Stories</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/png" href="Suspense Bangla logo design.png">

<style>
:root{
  --red:#e50914;
  --green:#2e7d32;
  --dark:#0f0f0f;
  --card:#1a1a1a;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:'Segoe UI',Roboto,sans-serif;
  background:var(--dark);
  color:white;
  padding-bottom:140px;
}

/* HEADER */
header{
  background:#000;
  padding:20px;
  position:sticky;
  top:0;
  z-index:1000;
  border-bottom:1px solid #222;
  text-align:center;
}

.header-wrap{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:10px;
}

.header-wrap img{
  height:70px;
  object-fit:contain;
}

.brand{
  font-size:32px;
  font-weight:900;
  letter-spacing:1px;
}

.brand span:first-child{color:var(--red)}
.brand span:last-child{color:var(--green)}

/* CONTAINER */
.container{
  max-width:1300px;
  margin:auto;
  padding:20px;
}

/* SEARCH */
.search-container{
  margin-bottom:30px;
}

.search{
  width:100%;
  padding:15px;
  border-radius:10px;
  border:1px solid #333;
  background:var(--card);
  color:white;
  font-size:16px;
  outline:none;
}

.search:focus{
  border-color:var(--red);
  box-shadow:0 0 10px rgba(229,9,20,.4);
}

/* GRID */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
  gap:24px;
}

/* CARD */
.card{
  background:var(--card);
  border-radius:16px;
  overflow:hidden;
  cursor:pointer;
  transition:.3s;
  border:1px solid #222;
  display:flex;
  flex-direction:column;
}

.card:hover{
  transform:translateY(-6px);
  border-color:var(--red);
}

.card img{
  width:100%;
  aspect-ratio:16/9;
  object-fit:cover;
}

.card .title{
  padding:16px;
  font-size:15px;
  font-weight:600;
  line-height:1.5;
  display:-webkit-box;
  -webkit-line-clamp:2;
  -webkit-box-orient:vertical;
  overflow:hidden;
}

/* LOAD MORE */
.load-more{
  margin:40px auto;
  display:none;
  padding:14px 35px;
  background:var(--red);
  border:none;
  border-radius:30px;
  color:white;
  font-weight:bold;
  cursor:pointer;
}

/* PLAYER */
.player{
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  background:#000;
  border-top:2px solid var(--red);
  padding:14px 20px;
  display:none;
  flex-direction:column;
  gap:10px;
  z-index:2000;
}

.player-top{
  display:flex;
  align-items:center;
  gap:14px;
}

.player-top img{
  width:60px;
  height:60px;
  border-radius:10px;
  object-fit:cover;
}

.player-text{
  flex:1;
  min-width:0;
}

.p-title{
  font-size:14px;
  font-weight:bold;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.p-status{
  font-size:12px;
  color:#aaa;
}

.time{
  font-size:12px;
  color:#aaa;
  margin-top:3px;
}

.play-btn{
  background:var(--red);
  border:none;
  width:45px;
  height:45px;
  border-radius:50%;
  color:white;
  font-size:18px;
  cursor:pointer;
}

/* PROGRESS */
.progress{
  width:100%;
  height:6px;
  background:#333;
  border-radius:5px;
  cursor:pointer;
  position:relative;
}

.progress-bar{
  height:100%;
  width:0%;
  background:var(--red);
  border-radius:5px;
}

#yt-hidden-wrap{
  position:fixed;
  top:-500px;
  opacity:0;
}

@media(max-width:700px){
  .grid{
    grid-template-columns:1fr;
  }
  .brand{
    font-size:28px;
  }
  .header-wrap img{
    height:60px;
  }
}
</style>
</head>
<body>

<header>
  <div class="header-wrap">
    <img src="Suspense Bangla logo design.png" alt="Suspense Bangla Logo">
    <div class="brand">
      <span>Suspense</span> <span>Bangla</span>
    </div>
  </div>
</header>

<div class="container">
  <div class="search-container">
    <input type="text" id="search" class="search"
    placeholder="Search by title, author, or keyword...">
  </div>

  <div class="grid" id="stories"></div>
  <button class="load-more" id="loadMore">Load More Stories</button>
</div>

<div class="player" id="player">
  <div class="player-top">
    <img id="playerImg">
    <div class="player-text">
      <div class="p-title" id="playerTitle">Select a story</div>
      <div class="p-status" id="playerStatus">Ready</div>
      <div class="time" id="audioTime">00:00 / 00:00</div>
    </div>
    <button class="play-btn" id="playPause">▶</button>
  </div>

  <div class="progress" id="progress">
    <div class="progress-bar" id="progressBar"></div>
  </div>
</div>

<div id="yt-hidden-wrap">
  <div id="yt-api-player"></div>
</div>

<script>
const JSON_URL = "https://raw.githubusercontent.com/Spin1234/suspense-data/main/stories.json";

let allStories=[];
let visibleCount=25;
let ytPlayer=null;
let progressInterval=null;

const tag=document.createElement('script');
tag.src="https://www.youtube.com/iframe_api";
document.head.appendChild(tag);

window.onYouTubeIframeAPIReady=()=>{
  ytPlayer=new YT.Player('yt-api-player',{
    height:'200',width:'200',
    playerVars:{autoplay:0,controls:0},
    events:{onStateChange:onPlayerStateChange}
  });
};

async function fetchStories(){
  try{
    const res=await fetch(JSON_URL);
    const data=await res.json();
    allStories=data
      .filter(item=>item.title)
      .sort((a,b)=>new Date(b.publishedAt)-new Date(a.publishedAt));
    renderStories();
  }catch(err){
    console.error("JSON Load Error:",err);
  }
}

function renderStories(){
  const container=document.getElementById("stories");
  const loadBtn=document.getElementById("loadMore");

  const rawQuery=document.getElementById("search").value.trim().toLowerCase();
  const keywords=rawQuery.split(" ").filter(k=>k.length>0);

  const filtered=allStories.filter(story=>{
    if(keywords.length===0) return true;
    const title=story.title.toLowerCase();
    return keywords.every(word=>title.includes(word));
  });

  container.innerHTML="";
  filtered.slice(0,visibleCount).forEach(story=>{
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`
      <img src="${story.thumbnail}">
      <div class="title">${story.title}</div>
    `;
    card.onclick=()=>playStory(story);
    container.appendChild(card);
  });

  loadBtn.style.display=visibleCount<filtered.length?"block":"none";
}

function playStory(story){
  document.getElementById("player").style.display="flex";
  document.getElementById("playerImg").src=story.thumbnail;
  document.getElementById("playerTitle").textContent=story.title;
  ytPlayer.loadVideoById(story.videoId);
  ytPlayer.playVideo();
}

function onPlayerStateChange(event){
  const btn=document.getElementById("playPause");
  const status=document.getElementById("playerStatus");

  if(event.data===YT.PlayerState.PLAYING){
    btn.textContent="❚❚";
    status.textContent="Playing Audio...";
    startProgress();
  }else if(event.data===YT.PlayerState.BUFFERING){
    status.textContent="Buffering...";
  }else{
    btn.textContent="▶";
    status.textContent="Paused";
    stopProgress();
  }
}

function formatTime(seconds){
  const mins=Math.floor(seconds/60);
  const secs=Math.floor(seconds%60);
  return `${mins.toString().padStart(2,'0')}:${secs.toString().padStart(2,'0')}`;
}

function startProgress(){
  progressInterval=setInterval(()=>{
    const current=ytPlayer.getCurrentTime();
    const duration=ytPlayer.getDuration();
    if(duration){
      const percent=(current/duration)*100;
      document.getElementById("progressBar").style.width=percent+"%";
      document.getElementById("audioTime").textContent=
        `${formatTime(current)} / ${formatTime(duration)}`;
    }
  },500);
}

function stopProgress(){
  clearInterval(progressInterval);
}

document.getElementById("progress").onclick=(e)=>{
  const width=e.currentTarget.clientWidth;
  const clickX=e.offsetX;
  const duration=ytPlayer.getDuration();
  ytPlayer.seekTo((clickX/width)*duration,true);
};

document.getElementById("playPause").onclick=()=>{
  const state=ytPlayer.getPlayerState();
  if(state===YT.PlayerState.PLAYING){
    ytPlayer.pauseVideo();
  }else{
    ytPlayer.playVideo();
  }
};

document.getElementById("search").oninput=()=>{
  visibleCount=25;
  renderStories();
};

document.getElementById("loadMore").onclick=()=>{
  visibleCount+=25;
  renderStories();
};

fetchStories();
</script>

</body>
</html>
